<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<section class="feedback">
    <a name="feedback"></a>
    <header>
        <h2>意见反馈</h2>
    </header>
    <!-- 提交成功、错误显示 -->
    <div class="wrap"<?php echo empty($status)?'style="display:none"':'' ?>>
        <?php if($status=='success'){ ?>
            <em class="icon-XST-wancheng show"></em><span>提交成功</span>
        <?php }else{ ?>
            <em class="icon-guanbi"></em><span>提交失败</span>
        <?php } ?>
        <p>感谢您的反馈，为您提供更好的体验是我们的追求。</p>
    </div>
    <!-- <form class="wrap" action="/about#feedback" method="POST"> -->
    <div class="wrap formDiv">
        <!--错误的时候在div上增加class:error-->
        <div<?php if($status=='success') echo ' class="error"' ?>>
            <textarea id="content" name="content" placeholder="请描述具体意见或建议" limit="10"><?php echo $content ?></textarea>
            <p class="error-tip"><em class="icon-jignshi"></em><span></span></p>
        </div>
        <div<?php if($status=='success') echo ' class="error"' ?>>
            <input id="contact" type="text" name="contact" placeholder="您的邮箱或QQ号码" value="<?php echo $contact ?>" />
            <p class="error-tip"><em class="icon-jignshi"></em><span></span></p>
        </div>
        <button>提交</button>
    </div>
    <!-- </form> -->
</section>
<!-- 视频播放弹出框 -->
<div class="video-box" style="display:none;">
    <div class="market"></div>
    <div class="wrap content">
        <a class="closed">
            <em class="icon-ic_exit_login"></em>
        </a>
        <div id="video"class="video">
            
        </div>
    </div>
</div>
<script type="text/javascript">
function valid(dom){
    var val = dom.val(), name = dom.attr('name');
    if(val == ''){
        if(name == 'content'){printError(dom, '请填写意见或建议内容');}
        if(name == 'contact'){printError(dom, '请填写邮箱或QQ号码');}
        return false;
    }
    if(name == 'contact'){
        var emailReg = new RegExp('^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$');
        var qqReg = new RegExp('^[1-9][0-9]{4,}$');
        if(!emailReg.test(val) && !qqReg.test(val)){
            printError(dom, '请输入合法的邮箱或QQ号');
            return false;
        }
    }
    if(dom.attr('limit')){
        var limits = dom.attr('limit').split(',', 2);
        var min = limits[0], max = limits[1] ? limits[1] : 0;
        if(val.length < min || (max > 0 && val.length > max)){
            printError(dom, '请输入'+min+(max>0?'-'+max+'位':'位以上')+'中英文');
            return false;
        }
    }
    cleanError(dom);
    return true;
}
function printError(dom, msg){
    dom.parent('div').addClass('error');
    dom.parent('div').find('p>span').html(msg);
}
function cleanError(dom){
    dom.parent('div').removeClass('error');
    dom.parent('div').find('p>span').html('');
}

$('.formDiv textarea,input').each(function(){
    $(this).on('blur', function(){valid($(this));});
});
$('.formDiv button').on('click', function(){
    var check = true;
    $(this).parent().find('textarea,input').each(function(){
        check &= valid($(this));
    });

    $.ajax({
            url:"/content/feedback",
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify({
                content : $.trim($('#content').val()),
                contact  : $.trim($('#contact').val())
            }),
            success: function (data) {
                if (data.status === 'success') {
                   
                } else if (data.status === 'fail') {
                   
                }
            }
        });
    })
    // $(this).attr('type', check?'submit':'button');
    // return check;
});
</script>
</body>
</html>